<html> 
<head>
  <style>
   *{padding: 0; margin:0;}
   canvas{ background: #eee; display: block; margin: 0 auto;}
   </style>
</head>
<body>
<canvas id= "myCanvas" width="256" height="240"></canvas>
<script type="text/javascript">
let canvas = document.getElementById("myCanvas");
let ctx = canvas.getContext("2d");
document.addEventListener("keydown",keyDownHandler, false);
document.addEventListener("keyup",keyUpHandler,false);
document.body.style.zoom = "288%";
let fps = 60;
let worldTiles = new Image();
worldTiles.src = "tiles-overworld.png";
let rightPressed = false;
let leftPressed = false;
let upPressed = false;
let downPressed = false;
let link1 = new Image();
link1.src = "link.png";
let hud = new Image();
hud.src = 'pausescreen.png'
let chars1 = new Image();
chars1.src = 'chars.png'
let chars2 = new Image();
chars2.src = 'chars2.png'
let animationCounter = 0;
let currentAnimation = 0;
let animationSpeed = 10;
let lastButtonPressed = "up";
let linkY = 135;
let linkX = 116;
let gameObjects = [];
let maps = [];
let gameMap = null;
let lastPickedUpItem = 0;
let playPickUpItemAnimation = false;

function GameObject(){
	this.x = 0;
	this.y = 0;
	this.width = 0;
	this.height = 0;
	this.newMap = 0;
	this.newLinkX = 0;
	this.newLinkY = 0;
	this.isPortal = false;

   this.counter = 0;
   this.imageNum = 0;
   this.isText = false;
   this.line1Full = ""
   this.line1Current = ""
   this.line1X = 0;
   this.line1Y = 0;
   this.line2Full = ""
   this.line2Current = ""
   this.line2X = 0;
   this.line2Y = 0;
   this.isOldMan = false;
   this.isPickUpItem = false;
   this.pickUpItemNum = 0;
   this.isFlame = false;
   this.isOldWoman = false;
}

function MapBundle(map, object){
	this.map = map;
	this.gameobjects = object;
}

function keyDownHandler(e){
    if(e.keyCode == 37){
	   leftPressed = true;
	   lastButtonPressed = "left";
	}
	else if(e.keyCode == 39){
	   rightPressed = true;
	   lastButtonPressed = "right";
	}
	else if(e.keyCode == 38){
	   upPressed = true;
	   lastButtonPressed = "up";
	}
	else if(e.keyCode == 40){
	   downPressed = true;
	   lastButtonPressed = "down";
	}
}

function keyUpHandler(e){
    if(e.keyCode == 37){
	   leftPressed = false;
	}
	else if(e.keyCode == 39){
	   rightPressed = false;
	}
	else if(e.keyCode == 38){
	   upPressed = false;
	}
	else if(e.keyCode == 40){
	   downPressed = false;
	}
}


function drawLink(){
	let speed = 2;
	animationCounter++;
	
	if(leftPressed && !collision(linkX - speed, linkY, gameMap)){
			linkX -= speed;
			if(currentAnimation == 0){
				ctx.drawImage(link1, 30, 0, 16, 16, linkX, linkY, 16, 16);
			}
			else if(currentAnimation == 1){
				ctx.drawImage(link1, 30, 30, 16, 16,linkX, linkY, 16, 16);
			}
			if(animationCounter >= 6){
				currentAnimation++;
				animationCounter = 0;
				if(currentAnimation > 1){
					currentAnimation = 0;
				}
			}
	}
	else if(rightPressed & !collision(linkX  + speed, linkY, gameMap)){
		linkX += speed;
		if(currentAnimation == 0){
				ctx.drawImage(link1, 91, 0, 16, 16, linkX, linkY, 16, 16);
			}
			else if(currentAnimation == 1){
				ctx.drawImage(link1, 91, 30, 16, 16,linkX, linkY, 16, 16);
			}
			if(animationCounter >= 6){
				currentAnimation++;
				animationCounter = 0;
				if(currentAnimation > 1){
					currentAnimation = 0;
				}
			}
	}
	else if(upPressed & !collision(linkX, linkY - speed, gameMap)){
		linkY -= speed;
		if(currentAnimation == 0){
				ctx.drawImage(link1, 62, 0, 16, 16, linkX, linkY, 16, 16);
			}
			else if(currentAnimation == 1){
				ctx.drawImage(link1, 62, 30, 16, 16,linkX, linkY, 16, 16);
			}
			if(animationCounter >= 6){
				currentAnimation++;
				animationCounter = 0;
				if(currentAnimation > 1){
					currentAnimation = 0;
				}
			}
	}
	else if(downPressed & !collision(linkX, linkY + speed, gameMap)){
		linkY += speed;
		if(currentAnimation == 0){
				ctx.drawImage(link1, 0, 0, 16, 16, linkX, linkY, 16, 16);
			}
			else if(currentAnimation == 1){
				ctx.drawImage(link1, 0, 30, 16, 16,linkX, linkY, 16, 16);
			}
			if(animationCounter >= 6){
				currentAnimation++;
				animationCounter = 0;
				if(currentAnimation > 1){
					currentAnimation = 0;
				}
			}
	}
	else{
		if(lastButtonPressed == "down"){
			ctx.drawImage(link1, 0, 0, 
			16, 16, linkX, linkY, 16, 16);
		}
		if(lastButtonPressed == "up"){
			ctx.drawImage(link1, 62, 0, 
			16, 16, linkX, linkY, 16, 16);
		}
		if(lastButtonPressed == "left"){
			ctx.drawImage(link1, 30, 0, 
			16, 16, linkX, linkY, 16, 16);
		}
		if(lastButtonPressed == "right"){
			ctx.drawImage(link1, 91, 0, 
			16, 16, linkX, linkY, 16, 16);
		}
	}
}

let map7_7 = [
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 61, 61, 61, 61, 61, 61, 61,  2,  2, 61, 61, 61, 61, 61, 61, 61],
[ 61, 61, 61, 61, 28, 61, 62,  2,  2, 61, 61, 61, 61, 61, 61, 61],
[ 61, 61, 61, 62,  2,  2,  2,  2,  2, 61, 61, 61, 61, 61, 61, 61],
[ 61, 61, 62,  2,  2,  2,  2,  2,  2, 61, 61, 61, 61, 61, 61, 61],
[ 61, 62,  2,  2,  2,  2,  2,  2,  2, 60, 61, 61, 61, 61, 61, 61],
[  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2],
[ 43, 44,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2, 43, 43],
[ 61, 61,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2, 61, 61],
[ 61, 61,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2, 61, 61],
[ 61, 61, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 61, 61],
[ 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61]];
let objects7_7 = [];

let gameObject = new GameObject();
gameObject.x = 72;
gameObject.y = 72;
gameObject.width = 8;
gameObject.height = 16;
gameObject.newMap = 1;
gameObject.newLinkX = 120;
gameObject.newLinkY = 220;
gameObject.isPortal = true;
objects7_7.push(gameObject);

let bundle = new MapBundle(map7_7, objects7_7);
maps.push(bundle);

///////////////////////////////////////////////////////////////////
let mapWoodSword = [
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55],
[ 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55],
[ 55, 55, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 55, 55],
[ 55, 55, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 55, 55],
[ 55, 55, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 55, 55],
[ 55, 55, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 55, 55],
[ 55, 55, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 55, 55],
[ 55, 55, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 55, 55],
[ 55, 55, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 55, 55],
[ 55, 55, 37, 37, 37, 37, 37, 28, 28, 37, 37, 37, 37, 37, 55, 55],
[ 55, 55, 55, 55, 55, 55, 55, 28, 28, 55, 55, 55, 55, 55, 55, 55]];
let gameObjectsWoodSword = [];

gameObject = new GameObject()
gameObject.x = (4 * 16) + 8;
gameObject.y = (8 * 16);
gameObject.width = 16;
gameObject.height = 16;
gameObject.isFlame = true;
gameObjectsWoodSword.push(gameObject);

gameObject = new GameObject()
gameObject.x = (10 * 16) + 8;
gameObject.y = (8 * 16);
gameObject.width = 16;
gameObject.height = 16;
gameObject.isFlame = true;
gameObjectsWoodSword.push(gameObject);

gameObject = new GameObject()
gameObject.x = (7 * 16) + 8;
gameObject.y = (8 * 16);
gameObject.width = 16;
gameObject.height = 16;
gameObject.isOldMan = true;
gameObjectsWoodSword.push(gameObject);

gameObject = new GameObject()
gameObject.x = (8 * 16) - 4;
gameObject.y = (9.5 * 16);
gameObject.width = 8;
gameObject.height = 16;
gameObject.isPickUpItem = true;
gameObject.pickUpItemNum = 14
gameObjectsWoodSword.push(gameObject);

gameObject = new GameObject()
gameObject.isText = true;
gameObject.line1Full = "IT'S DANGEROUS TO GO"
gameObject.line2Full = "ALONE! TAKE THIS!"
gameObject.line1X = 3 * 16
gameObject.line1Y = 7 * 16
gameObject.line2X = 4 * 16
gameObject.line2Y = (8 * 16) - 6
gameObjectsWoodSword.push(gameObject);

gameObject = new GameObject();
gameObject.x = 112;
gameObject.y = 240;
gameObject.width = 16;
gameObject.height = 16;
gameObject.newMap = 0;
gameObject.newLinkX = 68;
gameObject.newLinkY = 96;
gameObject.isPortal = true;
gameObjectsWoodSword.push(gameObject);

gameObject = new GameObject();
gameObject.x = 128;
gameObject.y = 240;
gameObject.width = 16;
gameObject.height = 16;
gameObject.newMap = 0;
gameObject.newLinkX = 68;
gameObject.newLinkY = 96;
gameObject.isPortal = true;
gameObjectsWoodSword.push(gameObject);

bundle = new MapBundle(mapWoodSword, gameObjectsWoodSword);
maps.push(bundle);
gameMap = maps[0].map;
gameObjects = maps[0].gameobjects;

function drawMap(level){
	for(let i = 0; i < level.length; i++){
		for(let j = 0; j < level[i].length; j++){
			ctx.drawImage(worldTiles, ((level[i][j]%18) * 17) + 1,
			(Math.floor(level[i][j]/18) * 17) + 1, 
			16, 16, j *16, i *16, 16, 16);
		}
	}
}

function collision(x, y, map){	
	for(let i = 0; i < map.length; i++){
		for(let j = 0; j < map[i].length; j++){
				if(map[i][j] != 2 && map[i][j] != 28){
					if (x <= j*16 + 16 &&
					   x + 12 >= j*16 &&
					   y + 10 <= i*16 + 16 &&
					   y + 16 >= i*16 ) 
{
						return true;
					}
				}
			}
	}
	return false;	
}

function gameObjectCollision(x, y, objects, isLink){
	if(isLink){
		for(let i = 0; i < objects.length; i++){
			if(x <= objects[i].x + objects[i].width &&
			x + 16 >= objects[i].x &&
			y <= objects[i].y + objects[i].height &&
			y + 16 >= objects[i].y){
				if(objects[i].isPortal){
					gameMap = maps[objects[i].newMap].map;
					gameObjects = maps[objects[i].newMap].gameobjects;
					linkX = objects[i].newLinkX;
					linkY = objects[i].newLinkY;
				}
			
			}
		}
	}
}

function drawGameObjects(){
   for(let i = 0; i < objects.length; i++){
      if(gameObjects[i].isPickUpItem) {
         // 0 => Boomerang
         // 1 => Bomb
         // 2 => Bow
         // 3 => Candle
         // 4 => Flute
         // 5 => Meat
         // 6 => Potion (red or blue)
         // 7 => Magic Rod
         // 8 => Raft
         // 9 => Book of Magic
         //10 => Ring
         //11 => Ladder
         //12 => key
         //13 => Bracelet
         //14 => Wooden Sword
         switch (gameObjects[i].pickUpItemNum) {
            case 0:
               break
            case 1:
               break
            case 2:
               break
            case 3:
               break
            case 4:
               break
            case 5:
               break
            case 6:
               break
            case 7:
               break
            case 8:
               break
            case 9:
               break
            case 10:
               break
            case 11:
               break
            case 12:
               break
            case 13:
               break
            case 14:
               ctx.drawImage(hud, 555, 137, 8, 16, gameObjects[i].x, gameObjects[i].y, 8, 16)
               break
         }
      }
      if(gameObjects[i].isText){
         gameObjects[i].counter += 1
         if (gameObjects[i].counter % 5 == 0) {
            if(gameObjects[i].line1Full.length != gameObjects[i].line1Current.length){
               gameObjects[i].line1Current = gameObjects[i].line1Full.substring(0, gameObjects[i].line1Current + 1)
            }
            else if(gameObjects[i].line2Full.length != gameObjects[i].line2Current.length){
               gameObjects[i].line2Current = gameObjects[i].line2Full.substring(0, gameObjects[i].line2Current + 1)
            }
         }
         ctx.fillStyle = "white"
         ctx.font = "12px Arial"
         ctx.fillText(gameObjects[i].line1Current, gameObjects[i].line1X, gameObjects[i].line1Y)
         ctx.fillText(gameObjects[i].line2Current, gameObjects[i].line2X, gameObjects[i].line2Y)
      }
      if(gameObjects[i].isFlame) {
         gameObjects.counter += 1
         if (gameObjects[i].counter % 5 == 0) gameObjects[i].imageNum += 1
         if (gameObjects[i].imageNum > 1) gameObjects[i].imageNum = 0
         if (gameObjects[i].imageNum == 0) {
            ctx.drawImage(chars2, 158, 11, 16, 16, gameObjects[i].x, gameObjects[i].y, 16, 16)
         }
         if (gameObjects[i].imageNum == 1) {
            ctx.drawImage(chars2, 52, 11, 16, 16, gameObjects[i].x, gameObjects[i].y, 16, 16)
         }
      }
      if(gameObjects[i].isOldMan) {
         ctx.drawImage(char1, 1, 11, 16, 16, gameObjects[i].x, gameObjects[i].y, 16, 16)
      }
   }
}

function draw () {
   setTimeout(function() {
   requestAnimationFrame(draw);
   ctx.fillStyle = "rgb(20,20,20)";
   ctx.fillRect(0,0,256,240);
   ///all code goes here
   drawMap(gameMap);
   drawLink();
   gameObjectCollision(linkX, linkY, gameObjects, true);
   },1000/fps);
}
draw();

</script>
</body>
</html>